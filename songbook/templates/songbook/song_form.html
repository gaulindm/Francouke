{% extends "songbook/base.html" %}
{% load crispy_forms_tags %}
{% block content %}
<style>
    body {
        padding-top: 70px; /* Adjust based on your navbar height */
    }
</style>
    <div class="container">
        <div class="row">
            <!-- Left Column: Form -->
            <div class="col-md-8">                
                <div class="content-section">
                    <form method="POST" id="song-form">
                        {% csrf_token %}
                        <fieldset class="form-group">
                            <legend class="border-bottom mb-4">
                                {% if form.instance.pk %}
                                    Edit Song
                                {% else %}
                                    New Song
                                {% endif %}
                            </legend>

                            <!-- Render non-accordion fields -->
                            {% for field in form %}
                                {% if field.name != 'metadata' and field.name != 'lyrics_with_chords' %}
                                    {{ field|as_crispy_field }}
                                {% endif %}
                            {% endfor %}

                        </fieldset>

                        <!-- Bootstrap Accordion for Metadata and Lyrics with Chords -->
                        <div class="accordion" id="formAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingMetadata">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMetadata" aria-expanded="false" aria-controls="collapseMetadata">
                                        Metadata and Lyrics with Chords
                                    </button>
                                </h2>
                                <div id="collapseMetadata" class="accordion-collapse collapse" aria-labelledby="headingMetadata" data-bs-parent="#formAccordion">
                                    <div class="accordion-body">
                                        <!-- Metadata Field -->
                                        <div id="metadataField">
                                            {{ form.metadata|as_crispy_field }}
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mt-3">
                            <button class="btn btn-outline-info" type="submit">
                                {% if form.instance.pk %}
                                    Update
                                {% else %}
                                    Create
                                {% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
         <!-- Right Column: Guide -->
        <div class="col-md-4">
            <div class="content-section border rounded p-3 bg-light">
                <h5>Guide</h5>
                <p>Use the form on the left to create or edit songs. Below are some helpful tips:</p>
                <ul>
                    <li><strong>Keybindings:</strong> Use Ctrl+S to save your work.</li>
                    <li><strong>Search & Replace:</strong> Use Ctrl+F to search, and Ctrl+H to replace text.</li>
                    <li><strong>Metadata:</strong> Metadata fields are optional but helpful for organizing your songs.</li>
                </ul>
                <p>For more advanced features, refer to the documentation or contact support.</p>
            </div>
        </div>   
    <!-- Include Bootstrap CSS -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
        rel="stylesheet"
    >

    <!-- Include CodeMirror CSS -->
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/codemirror@5.65.10/lib/codemirror.css"
    >

    <!-- Include CodeMirror JS -->
    <script
        src="https://cdn.jsdelivr.net/npm/codemirror@5.65.10/lib/codemirror.js"
    ></script>

    <!-- Include CodeMirror Markdown Mode -->
    <script
        src="https://cdn.jsdelivr.net/npm/codemirror@5.65.10/mode/markdown/markdown.js"
    ></script>

    <!-- Include Bootstrap JS -->
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    ></script>

    <script>
        // Initialize CodeMirror for the songChordPro field
        var editor = CodeMirror.fromTextArea(document.getElementById("id_songChordPro"), {
            mode: "markdown",
            lineNumbers: true,
            lineWrapping: true,
            theme: "default",
        });
    
        // Sync CodeMirror content with the textarea on form submission
        document.getElementById("song-form").addEventListener("submit", function(event) {
            // Update the textarea value with the editor content
            var textarea = document.getElementById("id_songChordPro");
            textarea.value = editor.getValue();
    
            // Temporarily remove the 'required' attribute and validation
            textarea.removeAttribute("required");
        });
    
        // Prevent the form from using native validation for hidden inputs
        document.getElementById("song-form").setAttribute("novalidate", "true");
    </script>
{% endblock content %}
